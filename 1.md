<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>机器人设置</title>
    <link rel="stylesheet" href="/app/admin/component/pear/css/pear.css"/>
</head>
<body class="pear-container">
<div class="layui-card">
    <div class="layui-card-body">
        <div class="layui-row layui-col-space10">
            <!-- 搜索栏 -->
            <div class="layui-col-md12">
                <form class="layui-form" lay-filter="searchForm">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">用户名</label>
                            <div class="layui-input-inline">
                                <input type="text" name="username" placeholder="请输入用户名" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <button type="submit" class="layui-btn layui-btn-sm" lay-submit lay-filter="search">
                                <i class="layui-icon layui-icon-search"></i> 搜索
                            </button>
                            <button type="reset" class="layui-btn layui-btn-sm layui-btn-primary">
                                <i class="layui-icon layui-icon-refresh"></i> 重置
                            </button>
                        </div>
                        <div class="layui-inline" style="float:right;">
                            <button type="button" class="layui-btn layui-btn-sm layui-btn-normal" id="addRobotBtn">
                                <i class="layui-icon layui-icon-add-1"></i> 添加机器人
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <!-- 数据表格 -->
            <div class="layui-col-md12">
                <table id="robotTable" lay-filter="robotTable"></table>
            </div>
        </div>
    </div>
</div>

<!-- 操作列工具栏 -->
<script type="text/html" id="toolBar">
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script src="/app/admin/component/layui/layui.js"></script>
<script src="/app/admin/component/pear/pear.js"></script>
<script>
layui.use(['table', 'form', 'layer', 'jquery'], function() {
    var table = layui.table;
    var form = layui.form;
    var layer = layui.layer;
    var $ = layui.jquery;
    
    // 渲染表格
    table.render({
        elem: '#robotTable',
        url: '/app/admin/robot/setting',
        page: true,
        limit: 20,
        limits: [10, 20, 30, 50, 100],
        cols: [[
            {field: 'id', title: 'ID', width: 80, sort: true, align: 'center'},
            {field: 'username', title: '用户名', width: 150, align: 'center'},
            {field: 'balance', title: '余额', width: 120, align: 'center', templet: function(d) {
                return parseFloat(d.balance).toFixed(2);
            }},
            {field: 'groupid', title: '会员组', width: 100, align: 'center'},
            {field: 'isonline', title: '在线状态', width: 100, align: 'center', templet: function(d) {
                var color = d.isonline_raw == 1 ? 'green' : 'red';
                return '<span style="color:' + color + '">' + d.isonline + '</span>';
            }},
            {field: 'regtime', title: '注册时间', width: 180, align: 'center'},
            {title: '操作', width: 100, toolbar: '#toolBar', align: 'center', fixed: 'right'}
        ]],
        done: function(res, curr, count) {
            console.log('表格数据加载完成', res);
        }
    });
    
    // 搜索
    form.on('submit(search)', function(data) {
        table.reload('robotTable', {
            where: data.field,
            page: {curr: 1}
        });
        return false;
    });
    
    // 添加机器人
    $('#addRobotBtn').click(function() {
        layer.open({
            type: 2,
            title: '添加机器人',
            content: '/app/admin/robot/add-robot',
            area: ['500px', '400px'],
            end: function() {
                table.reload('robotTable');
            }
        });
    });
    
    // 监听工具条
    table.on('tool(robotTable)', function(obj) {
        var data = obj.data;
        
        if (obj.event === 'del') {
            layer.confirm('确定删除该机器人账号吗？', function(index) {
                $.post('/app/admin/robot/delete-robot', {id: data.id}, function(res) {
                    if (res.code === 0) {
                        layer.msg('删除成功', {icon: 1});
                        obj.del();
                    } else {
                        layer.msg(res.msg, {icon: 2});
                    }
                }, 'json');
                layer.close(index);
            });
        }
    });
});
</script>
</body>
</html>

